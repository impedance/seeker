# План разработки приложения для просмотра БД ГЭСН

Цель: дать джуну набор задач по 1-2 часа с понятными критериями готовности.

## Статус
- [x] t1 BaseX базы созданы и HTTP сервер проверен (в песочнице не поднимается).
- [x] t2 Структура проекта `app/` создана.
- [x] t3 Базовая HTML-разметка с Bootstrap и модулями создана.
- [x] t4 CSS базовая сетка и скролл панелей.
- [x] t5 CSS для дерева и состояний.
- [x] t6 CSS для панели деталей и таблицы ресурсов.
- [x] t7 Адаптивность.
- [x] t8 Полный CONFIG.
- [ ] t9+ Остальные задачи ниже.

## Принципы разбивки
- 1 задача = 1-2 часа.
- В каждой задаче: цель, файлы, критерий готовности.
- Если задача зависит от другой, это указано.

---

# Фаза 2: Визуальный слой

## [x] t4. CSS базовая сетка и скролл панелей (1-2ч)
**Файлы:** `app/css/style.css`  
**Цель:** три панели + шапка влезают в 100vh, каждая панель скроллится отдельно.  
**Готово:** панели фиксированы по высоте, прокрутка не ломает верстку.

## [x] t5. CSS для дерева и состояний (1-2ч)
**Файлы:** `app/css/style.css`  
**Цель:** понятные отступы/иконки, hover/active/disabled.  
**Готово:** узлы дерева читаемы, активный узел выделяется.

## [x] t6. CSS для панели деталей и таблицы ресурсов (1-2ч)
**Файлы:** `app/css/style.css`  
**Цель:** карточки, таблица, статусы загрузки/ошибок.  
**Готово:** детали выглядят аккуратно, нет визуальных «прыжков».

## [x] t7. Адаптивность (1-2ч)
**Файлы:** `app/css/style.css`, `app/index.html`  
**Цель:** корректно на мобильных/узких экранах.  
**Готово:** панели складываются, контент не выходит за экран.

---

# Фаза 3: Конфиг и API

## [x] t8. Полный CONFIG (1-2ч)
**Файлы:** `app/js/config.js`  
**Цель:** заполнить `CONFIG` (BaseX URL, базы, метаданные, таймауты).  
**Готово:** `CONFIG` покрывает все базы, есть `requestTimeout`, `pageSize`.

## [x] t9. API: базовый fetch + таймаут (1-2ч)
**Файлы:** `app/js/api.js`  
**Цель:** `executeQuery(database, xquery)` с таймаутом и проверкой HTTP.  
**Готово:** корректно возвращает строку XML или понятную ошибку.

## [x] t10. API: парсинг XML и базовые модели (1-2ч)
**Файлы:** `app/js/api.js`  
**Цель:** `DOMParser` -> JS-объекты (Section/Work/Resource).  
**Готово:** есть функции `parseSections`, `parseWorkDetails`.

## [x] t11. API: XQuery обертки (1-2ч)
**Файлы:** `app/js/api.js`  
**Цель:** `getSections`, `getChildren`, `getWorkDetails`, `search`.  
**Готово:** методы вызываются из DevTools без исключений.

## [x] t12. API: кэш и ошибки (1-2ч)
**Файлы:** `app/js/api.js`  
**Цель:** простой кэш (Map + TTL) + унификация ошибок.  
**Готово:** повторные запросы быстрые, ошибки читаемы.

---

# Фаза 4: Навигация и UI

## [ ] t13. Navigation: состояние и события (1-2ч)
**Файлы:** `app/js/navigation.js`  
**Цель:** модель состояния (`currentDatabase`, `path`, `expanded`, `selected`).  
**Готово:** есть геттеры/сеттеры + подписка на изменения.

## [ ] t14. Navigation: загрузка разделов (1-2ч)
**Файлы:** `app/js/navigation.js`  
**Цель:** `loadSections()` + переключение базы.  
**Готово:** при смене базы обновляется дерево.

## [ ] t15. Navigation: раскрытие узлов (1-2ч)
**Файлы:** `app/js/navigation.js`  
**Цель:** `expandNode(code)` с кэшем и обновлением UI.  
**Готово:** клики раскрывают/сворачивают узлы.

## [ ] t16. UI: список баз (1-2ч)
**Файлы:** `app/js/ui.js`  
**Цель:** отрисовать список баз и активное состояние.  
**Готово:** клик по базе вызывает `Navigation.loadSections`.

## [ ] t17. UI: дерево (1-2ч)
**Файлы:** `app/js/ui.js`  
**Цель:** `renderTree` + `renderTreeNode` с data-атрибутами.  
**Готово:** дерево отображается и реагирует на клики.

## [ ] t18. UI: детали работы (1-2ч)
**Файлы:** `app/js/ui.js`  
**Цель:** карточка Work + таблица ресурсов (без цен).  
**Готово:** выбранный Work отображается в правой панели.

## [ ] t19. UI: загрузка и ошибки (1-2ч)
**Файлы:** `app/js/ui.js`  
**Цель:** `showLoading`, `hideLoading`, `showError`.  
**Готово:** состояние видно пользователю.

## [ ] t20. UI: breadcrumbs (1-2ч)
**Файлы:** `app/js/ui.js`, `app/index.html`  
**Цель:** хлебные крошки кликабельны, последний пункт активен.  
**Готово:** путь обновляется при навигации.

---

# Фаза 5: Поиск

## [ ] t21. Search: debounce и интеграция поля (1-2ч)
**Файлы:** `app/js/search.js`, `app/js/main.js`  
**Цель:** debounce ~300мс и обработчик `#search-input`.  
**Готово:** поиск не спамит API.

## [ ] t22. Search: XQuery и группировка (1-2ч)
**Файлы:** `app/js/search.js`  
**Цель:** поиск по коду/названию/ресурсу и группировка по базам.  
**Готово:** результаты структурированы.

## [ ] t23. Search: рендер результатов (1-2ч)
**Файлы:** `app/js/ui.js`, `app/js/search.js`  
**Цель:** кликабельные результаты ведут в дерево.  
**Готово:** клик открывает нужный Work/узел.

---

# Фаза 6: Связи между базами

## [ ] t24. API: цены ресурсов (1-2ч)
**Файлы:** `app/js/api.js`  
**Цель:** запросы в `fsbts_mat`/`fsbts_mash` по коду.  
**Готово:** в ответе Work есть цена и название.

## [ ] t25. UI: подсветка ресурсов с/без цены (1-2ч)
**Файлы:** `app/js/ui.js`, `app/css/style.css`  
**Цель:** зеленый/красный статус.  
**Готово:** таблица визуально показывает заполненность.

## [ ] t26. Навигация к ресурсу из таблицы (1-2ч)
**Файлы:** `app/js/navigation.js`, `app/js/ui.js`  
**Цель:** клик по ресурсу ведет в справочник.  
**Готово:** переход работает, выделение корректно.

## [ ] t27. История переходов (1-2ч)
**Файлы:** `app/js/navigation.js`  
**Цель:** назад/вперед между Work и ресурсом.  
**Готово:** есть стек истории + кнопка «Назад».

---

# Фаза 7: Расширения

## [ ] t28. Фильтры дерева (1-2ч)
**Файлы:** `app/index.html`, `app/js/ui.js`  
**Цель:** чекбоксы по типам узлов.  
**Готово:** фильтр скрывает типы, состояние сохраняется.

## [ ] t29. Экспорт Work (1-2ч)
**Файлы:** `app/js/export.js`, `app/js/ui.js`  
**Цель:** экспорт JSON/CSV через blob.  
**Готово:** скачивается файл с ресурсами и ценами.

## [ ] t30. Избранное (1-2ч)
**Файлы:** `app/js/favorites.js`, `app/js/ui.js`  
**Цель:** хранить в localStorage, список в левой панели.  
**Готово:** добавление/удаление работает после перезагрузки.

---

# Фаза 8: Стабильность и качество

## [ ] t31. Проверка сценариев (1-2ч)
**Файлы:** `docs/status.md`  
**Цель:** пройти сценарии из блока «Проверка».  
**Готово:** заметки о результатах в `docs/status.md`.

## [ ] t32. Ошибки и ретраи (1-2ч)
**Файлы:** `app/js/api.js`, `app/js/ui.js`  
**Цель:** обработка 404/timeout/400, кнопка «Повторить».  
**Готово:** UI показывает корректные сообщения.

## [ ] t33. Оптимизация DOM (1-2ч)
**Файлы:** `app/js/ui.js`  
**Цель:** DocumentFragment, минимизация перерисовок.  
**Готово:** дерево раскрывается быстрее на больших данных.

## [ ] t34. Мини-профилирование (1-2ч)
**Файлы:** `docs/status.md`  
**Цель:** записать метрики (первый уровень/раскрытие/поиск).  
**Готово:** метрики в статусе, есть выводы.

---

# Фаза 9: Документация

## [ ] t35. README приложения (1-2ч)
**Файлы:** `app/README.md`  
**Цель:** инструкция пользователя + скриншоты.  
**Готово:** описан запуск и основные возможности.

## [ ] t36. DEV документация (1-2ч)
**Файлы:** `app/DEVELOPMENT.md`  
**Цель:** архитектура модулей и примеры XQuery.  
**Готово:** новому разработчику понятно, где что искать.

---

# Минимум Done (при завершении фазы или крупной задачи)
- Обновить `docs/status.md`, если фокус/план изменился.
- Проверить `rg -n "AICODE-" README.md docs/*.md` после правок.
- Запустить `npm run lint:aicode` и тесты проекта (если есть).
