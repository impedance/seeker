<!-- AICODE-NOTE: NAV/PLAYWRIGHT_TESTS plan: быстрый план E2E smoke-тестов на Playwright -->

# План автоматики на Playwright (принцип 80/20)

## Цель
Собрать минимальный набор Playwright-скриптов, которые проверяют ключевые потоки загрузки баз, дерева и деталей, чтобы оперативно ловить регрессии в пользовательском дереве.

## Scope + non-goals
- **Scope:** автоматизировать подтверждение, что переключение между крупными базами (`gesn`, `gesnmr`, `gesnp` и другие) загружает список сборников, раскрытие веток подгружает `children`, выбор работы показывает карточку с ресурсами и поиск ведёт к тому же поведению.
- **Non-goals:** полная параллельная проверка всех возможных секций/работ, нагрузочное тестирование BaseX или реконфигурация сервера; это не end-to-end всех API, только UI-путь.

## Тактика (80/20)
1. Запустить `./scripts/start-dev.sh` как шаг `beforeAll`, дождаться базового состояния (индикатор загрузки, список баз).
2. Наиболее тяжёлые и важные базы: `gesn`, `gesnmr`, `gesnp`. Для каждой выбрать элемент списка, ждать сброса `app-loader`, проверить существование хотя бы одной `div.tree-item.section-node`.
3. Раз раскрыть две разные ветки в каждом дереве (клики по `section-node`), убедиться, что появляется дочерняя группа (`data-level >`).
4. Выбрать работу (`.work-node[data-code="..."]`), проверить, что `#details-content` содержит «Ресурсы» и таблицу, а хлебные крошки обновлены.
5. Проверить поиск: набрать кейворд (например, код известной работы), кликнуть результат и удостовериться, что дерево соответствует пути (последний `work-node` активен).
6. Для `getChildren`/`loadSections` добавить прослушивание Network, гарантировать, что при повторном раскрытии `requestfinished` быстрое (подтверждение кеша).

## Технические детали
- Использовать Playwright (или аналог) с браузером Chromium в headless или headed режиме.
- Добавить простые `expect` на появление `dataset.code`, `innerText` и отсутствие ошибок (`page.on('console', ...)`).
- Вставить `performance.mark`/`console.time` рядом с `loadSections`/`renderTree` (опционально) и собрать данные через `page.evaluate`.
- Запуск: `npx playwright test --project=chromium` после `./scripts/start-dev.sh` (или через `npm run test:e2e`, если появится).

## Проверки и сигналы
- `tree-item.section-node` появляется в течении 5 секунд после выбора базы.
- После клика по секции `data-level` увеличивается и `.tree-item` с `data-type="work"` рендерится.
- Детали работы содержат строку «Ресурсы» и описаны в `details-content`.
- Поиск раскрывает дерево так, что активный `work-node` имеет класс `active` и `data-code` совпадает с запросом.
- Нет ошибок в консоли браузера и сеть не выдает 5xx.

## Следующие шаги
1. Прописать тесты в Playwright-файле (`tests/base-load.spec.ts`) по описанному чеклисту.
2. Добавить `setup`/`teardown` для `./scripts/start-dev.sh` и устроить ждать BaseX.
3. Включить тесты в CI (или локальный `npm run test:e2e`), чтобы при любом изменении загрузки баз регрессия заметилась незамедлительно.
